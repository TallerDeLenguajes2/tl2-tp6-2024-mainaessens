@model PresupuestoViewModel

<form asp-action="CrearPresupuesto" method="post" class="container mt-4 p-4 border rounded bg-light">
    @Html.AntiForgeryToken()
    <h2 class="text-center mb-4">Crear Presupuesto</h2>

    <div class="mb-3">
        <label for="ClienteIdSeleccionado" class="form-label">Seleccione Cliente:</label>
        <select asp-for="ClienteIdSeleccionado" asp-items="@(new SelectList(Model.Clientes, "Id", "Nombre"))" class="form-select">
            <option value="0">Seleccione un cliente</option>
        </select>
    </div>

    <div id="productos-container">
        <h4>Productos:</h4>
        <button type="button" class="btn btn-primary mb-3" onclick="addProductField()">Agregar Producto</button>

        <div class="producto-field row mb-2">
            <div class="col-md-8">
                <select name="ProductosSeleccionados[0].ProductoId" class="form-select">
                    @foreach (var producto in Model.Productos)
                    {
                        <option value="@producto.IdProducto">@producto.Descripcion</option>
                    }
                </select>
            </div>
            <div class="col-md-4">
                <input type="number" name="ProductosSeleccionados[0].Cantidad" min="1" placeholder="Cantidad" class="form-control" />
            </div>
        </div>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-success">Crear Presupuesto</button>
        <a asp-action="Index" class="btn btn-danger">Cancelar</a>
    </div>
</form>

<script>
    let productIndex = 1;

    function addProductField() {
        const container = document.getElementById('productos-container');
        const newField = document.createElement('div');
        newField.className = 'producto-field row mb-2';
        newField.innerHTML = `
            <div class="col-md-8">
                <select name="ProductosSeleccionados[${productIndex}].ProductoId" class="form-select">
                    @foreach (var producto in Model.Productos)
                    {
                        <option value="@producto.IdProducto">@producto.Descripcion</option>
                    }
                </select>
            </div>
            <div class="col-md-4">
                <input type="number" name="ProductosSeleccionados[${productIndex}].Cantidad" min="1" placeholder="Cantidad" class="form-control" />
            </div>
        `;
        container.appendChild(newField);
        productIndex++;
    }
</script>
